<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GPX Map Matcher</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
</head>
<body>
  <h1>Phone GPS Motorsports Track Enhancer and Analyzer</h1>

  <form method="POST" enctype="multipart/form-data">
    <p>Select a GPX file to upload and process:</p>
    <input type="file" name="gpx_file" accept=".gpx" required />
    <button type="submit">Upload and Process</button>
  </form>

  {% if track and track|length > 0 %}
    <div id="map"></div>
    <p class="info">
      Click on the map to set a <strong>start</strong> point and an <strong>end</strong> point on the track 
      for measurement. You can then see the distance, time, and speed for that segment.
    </p>
    <p class="info" id="measure-result"></p>
    <div class="action-buttons">
      <a href="{{ url_for('download') }}" class="btn">Download Corrected GPX</a>
      <button id="save-markers-btn" class="btn">Save Markers</button>
      <button id="clear-markers-btn" class="btn">Clear Markers</button>
    </div>
    <div>
      <button onclick="toggleDebug()">Toggle Debug Info</button>
      <div id="debug-info" class="debug"></div>
    </div>
  {% else %}
    <div id="map" style="display: none;"></div>
    <p class="info">Please upload a GPX file to process and view the track.</p>
  {% endif %}

  {% if message %}
    <p><em>{{ message }}</em></p>
  {% endif %}

  {% if track and track|length > 0 %}
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      let trackPoints = JSON.parse('{{ track_json|safe }}');
    </script>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  {% endif %}
</body>
</html>
